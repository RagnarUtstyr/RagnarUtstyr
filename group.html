<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" sizes="64x64" href="favicon-64x64.png">
    <title>Initiative</title>
    <script type="module" src="server.js" defer></script>
    <script type="module" src="health.js" defer></script> 
    <link rel="stylesheet" href="style.css"> 
    <link rel="stylesheet" href="turn.css"> 
    <link rel="stylesheet" href="save.css"> 
    <script src="turn.js" defer></script> 
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet"> 
</head>

<body>

    <div class="container">
        <h1>Create or Join a Room</h1>
        <label for="room-key">Room Key:</label>
        <input type="text" id="room-key" placeholder="Enter a room key">
        <button id="create-room-button">Create Room</button>
    </div>

    <div class="container">
        <h1>Initiative</h1>
        
        <ul id="rankingList"></ul>

        <div class="button-container">
            <button id="apply-damage-button">Apply Damage</button>
            <button id="next-button">Next</button>
        </div>

        <br>
        <button id="clear-list-button">Clear List</button>
        <br><br>
       
        <br><br>
        <h2>Submit a New Entry</h2>
        <label for="name">Name:</label>
        <input type="text" id="name" required>
        
        <label for="initiative">Initiative:</label>
        <input type="number" id="initiative" required>
        
        <label for="health">Health:</label>
        <input type="number" id="health">

        <label for="ac">AC:</label>
        <input type="number" id="ac">

        <button id="submit-button">Submit</button>

        <br><br>
        <a href="save.html" class="button-link">Go to Lists</a>
        <a href="monster.html" class="button-link">Go to Monster List</a>
    </div>

    <script>
        // Check if the user is logged in
        const roomKey = localStorage.getItem('roomKey');
        if (!roomKey) {
            alert('You must log in with a room key.');
            window.location.href = 'index.html'; // Redirect to login page
        }

        // Continue with your existing Firebase logic
        const reference = ref(db, `rankings/${roomKey}`);

        // Example of fetching data for the room
        function fetchRankings() {
            onValue(reference, (snapshot) => {
                const data = snapshot.val();
                const rankingList = document.getElementById('rankingList');
                rankingList.innerHTML = '';

                if (data) {
                    const rankings = Object.entries(data).map(([id, entry]) => ({ id, ...entry }));
                    rankings.sort((a, b) => b.number - a.number);

                    rankings.forEach(({ id, name, number, health, ac }) => {
                        const listItem = document.createElement('li');
                        listItem.textContent = `${name} (Initiative: ${number}, HP: ${health || ''}, AC: ${ac || ''})`;
                        rankingList.appendChild(listItem);
                    });
                }
            });
        }

        fetchRankings(); // Fetch rankings when the page loads
    </script>
</body>
</html>
